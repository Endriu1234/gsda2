<div class="container-fluid">
    <div class="row jktmp">
        <mat-tab-group>
            <mat-tab label="SD Project / Packet">
                <app-batch-creation-sdcriteria></app-batch-creation-sdcriteria>
            </mat-tab>
            <mat-tab label="TMS Task">
                <app-batch-creation-tmscriteria></app-batch-creation-tmscriteria>
            </mat-tab>
            <mat-tab label="Redmine">
                <app-batch-creation-redmine-criteria></app-batch-creation-redmine-criteria>
            </mat-tab>
            <mat-tab label="SD / TMS Ids">
                <!-- <app-batch-creation-idscriteria></app-batch-creation-idscriteria> -->
            </mat-tab>
        </mat-tab-group>
    </div>
    <div *ngIf="formState$ | async as formState" [style.visibility]="(getBatchItemCreationCanActivateGrid$ | async)?'visible':'hidden'" class="row jkshadow">
        <div class="d-flex flex-md-row justify-content-md-between flex-column">
            <mat-form-field class="filter dense-1">
                <mat-label>Filter</mat-label>
                <input matInput (keyup)="applyFilter($event)" #input>
            </mat-form-field>
            <div class="filter dense-1 d-flex flex-row">
                <mat-form-field subscriptSizing="dynamic">
                    <mat-label>Add column(s)</mat-label>
                    <mat-select multiple [disabled]="!(hasDeletedColumns$ | async)" [(value)]="selectedDeletedValues" [ngrxFormControlState]="$any(formState).controls.deletedColumnsSelToAdd">
                        <mat-option *ngFor="let column of (deletedColumns$ | async)" [value]="column">{{column}}</mat-option>
                    </mat-select>
                </mat-form-field>
                <button mat-fab class="jkbutton" [disabled]="!(hasDeletedColumnsSelToAdd$ | async)" (click)="addColumns()">
                    <mat-icon class="jkIcon"><svg 
                            xmlns="http://www.w3.org/2000/svg" 
                            shape-rendering="geometricPrecision" 
                            text-rendering="geometricPrecision" 
                            image-rendering="optimizeQuality" 
                            fill-rule="evenodd" 
                            clip-rule="evenodd" 
                            viewBox="0 0 512 511.99"><path fill="#00AB42" [ngClass]="{'jkSvg': (hasDeletedColumnsSelToAdd$ | async), 'jkSvgInactive': !(hasDeletedColumnsSelToAdd$ | async)}" fill-rule="nonzero" d="M256 0c70.68 0 134.69 28.66 181.01 74.98C483.35 121.31 512 185.31 512 255.99c0 70.68-28.66 134.69-74.99 181.02-46.32 46.32-110.33 74.98-181.01 74.98-70.68 0-134.69-28.66-181.02-74.98C28.66 390.68 0 326.67 0 255.99S28.65 121.31 74.99 74.98C121.31 28.66 185.32 0 256 0zm116.73 236.15v39.69c0 9.39-7.72 17.12-17.11 17.12h-62.66v62.66c0 9.4-7.71 17.11-17.11 17.11h-39.7c-9.4 0-17.11-7.69-17.11-17.11v-62.66h-62.66c-9.39 0-17.11-7.7-17.11-17.12v-39.69c0-9.41 7.69-17.11 17.11-17.11h62.66v-62.67c0-9.41 7.7-17.11 17.11-17.11h39.7c9.41 0 17.11 7.71 17.11 17.11v62.67h62.66c9.42 0 17.11 7.76 17.11 17.11zm37.32-134.21c-39.41-39.41-93.89-63.8-154.05-63.8-60.16 0-114.64 24.39-154.05 63.8-39.42 39.42-63.81 93.89-63.81 154.05 0 60.16 24.39 114.64 63.8 154.06 39.42 39.41 93.9 63.8 154.06 63.8s114.64-24.39 154.05-63.8c39.42-39.42 63.81-93.9 63.81-154.06s-24.39-114.63-63.81-154.05z"/></svg></mat-icon>
                </button>
            </div>
        </div>
        <div>
            <table mat-table [dataSource]="dataSource" multiTemplateDataRows matSort cdkDropList
                cdkDropListOrientation="horizontal" (cdkDropListDropped)="drop($event)" class="mat-elevation-z1">
                <ng-container matColumnDef="SELECT">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="!isIndeterminate()" cdkDrag>
                        <mat-checkbox color="primary" (change)="$event ? toggleAllRows() : null" [checked]="isAllSelected()"
                            [indeterminate]="isIndeterminate()">
                        </mat-checkbox>
                    </th>
                    <td mat-cell *matCellDef="let row">
                        <mat-checkbox color="primary" (click)="$event.stopPropagation()"
                            (change)="$event ? (toggleRowSelection(row)) : null" [checked]="row.SELECTED">
                        </mat-checkbox>
                    </td>
                </ng-container>

                <ng-container matColumnDef="SUBJECT">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag> Subject
                        <button mat-icon-button (click)="removeColumn('SUBJECT'); $event.stopPropagation()">
                            <span class="material-symbols-rounded menu-item-icon">close</span>
                        </button>
                    </th>
                    <td mat-cell *matCellDef="let element"> {{element.SUBJECT}} </td>
                </ng-container>

                <ng-container matColumnDef="ISSUE">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag> Issue
                        <button mat-icon-button (click)="removeColumn('ISSUE'); $event.stopPropagation()">
                            <span class="material-symbols-rounded menu-item-icon">close</span>
                        </button>
                    </th>
                    <td mat-cell *matCellDef="let element"> {{element.ISSUE}} </td>
                </ng-container>

                <ng-container matColumnDef="CR">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag> CR
                        <button mat-icon-button (click)="removeColumn('CR'); $event.stopPropagation()">
                            <span class="material-symbols-rounded menu-item-icon">close</span>
                        </button>
                    </th>
                    <td mat-cell *matCellDef="let element"> {{element.CR}} </td>
                </ng-container>

                <ng-container matColumnDef="expand">
                    <th mat-header-cell *matHeaderCellDef>&nbsp;</th>
                    <td mat-cell *matCellDef="let element">
                        <button mat-icon-button aria-label="expand row"
                        (click)="(expandedElement = expandedElement === element ? null : element); $event.stopPropagation()">
                        <span *ngIf="expandedElement !== element" class="material-symbols-rounded menu-item-icon ">expand_more</span>
                        <span *ngIf="expandedElement === element" class="material-symbols-rounded menu-item-icon ">expand_less</span>
                    </button>
                    </td>
                </ng-container>

                <ng-container matColumnDef="expandedDetail">
                    <td mat-cell *matCellDef="let element" [attr.colspan]="(displayedColumnsLength$ | async)">
                        <div class="example-element-detail"
                            [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                            <div class="example-element-description">
                                {{element.DESCRIPTION}}
                            </div>
                        </div>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="(displayedColumns$ | async)"></tr>
                <tr mat-row *matRowDef="let row; columns: (displayedColumns$ | async);" class="example-element-row"
                    [class.example-expanded-row]="expandedElement === row"
                    (click)="expandedElement = expandedElement === row ? null : row">
                </tr>
                <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
                <tr class="mat-row" *matNoDataRow>
                    <td *ngIf="dataSource.data.length > 0" class="mat-cell" colspan="4">No data matching the filter
                        "{{input.value}}"</td>
                </tr>
            </table>
        </div>
        <div>
            <mat-paginator [pageSize]="25" [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
        </div>
    </div>

    <ng-container *ngIf="formState$ | async as formState">
            <mat-card-actions [align]="'end'" *ngIf="(getBatchItemCreationCanActivateGrid$ | async)">
                <form novalidate [ngrxFormState]="formState">
                    <mat-checkbox color="primary" 
                        class="me-4 my-2 jk-primary-chekbox mat-elevation-z4" 
                        [ngrxFormControlState]="$any(formState).controls.skipCreationForm"
                    >Skip Creation  Form</mat-checkbox>
                    <button mat-fab 
                        extended 
                        color="primary" 
                        class="me-3 my-2" 
                        [disableMatFabButton]="!(isAnyRecordSelected$ | async)"
                        (click)="createBatch()"
                    >Create Batch</button>
                </form>
            </mat-card-actions>
    </ng-container>
</div>